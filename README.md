ros-bloom-debhelper
===================

[`bloom`][bloom] your [ROS][ros] projects with the full power of
[`debhelper`][debhelper].

# tldr

    $ tree ~/my_catkin_ws
    /home/user/my_catkin_ws
    `-- src
        `-- my_project
            |-- CMakeLists.txt
            |-- debian
            |   |-- logrotate.em
            |   |-- service.em
            |   `-- udev.em
            |-- etc
            |   `-- rsyslog.d
            |       `-- 99-slug.conf.in
            |-- package.xml
            `-- src
                `-- main.cpp

    $ bloom-release --rosdistro melodic ...
    ...
    $ git clone file:///path/to/my_catkin_ws-release.git
    ...
    $ cd my_catkin_ws-release
    $ git checkout debian/melodic/bionic/my_project
    $ gbp buildpackage -us -uc --source-option='-i.*'
    ...
    $ dpkg-deb -R ../ros-melodic-my-project_0.0.1_amd64.deb ../ros-melodic-my-project_0.0.1_amd64.deb.raw
    $ tree ../ros-melodic-my-project_0.0.1_amd64.deb.raw
    ../ros-melodic-my-project_0.0.1_amd64.deb.raw/
    |-- DEBIAN
    |   |-- conffiles
    |   |-- control
    |   |-- md5sums
    |   |-- postinst
    |   |-- postrm
    |   |-- preinst
    |   `-- prerm
    |-- etc
    |   |-- logrotate.d
    |   |   `-- ros-melodic-my-project
    |   `-- rsyslog.d
    |       `-- 99-ros-melodic-my-project.conf
    |-- lib
    |   |-- systemd
    |   |   `-- system
    |   |       `-- ros-melodic-my-project.service
    |   `-- udev
    |       `-- rules.d
    |           `-- 60-ros-melodic-my-project.rules
    ...

# What?

You can `bloom` your ROS project (that thing you build with [`catkin`][catkin])
into a Debian package archive (`*.deb`) that installs one (or more) of the
following:

* `systemd` service units
* `udev` rules
* `logrotate` config files
* more coming soon

# Why?

Because you're a [Debian package maintainer][debmaintguide] and you want to do
one (or more) of the following:

* run your ROS application as a [`systemd` service][systemdservice] unit
* use `udev` to detect and configure new/custom/unusual hardware
* rotate logs generated by your ROS application
* more coming soon

# How?

There are really two mechanisms enabling this trick. The first is the manner by
which `bloom` populates the `debian` directory of the released package. The
second is the fallback behavior in [`debhelper`][debhelper].

## How does `bloom` populate the `debian` directory?

todo: write this

## How does `debhelper` find files?

When `debhelper` goes looking for files, it searches under the `debian`
directory. Some of these files are [required][dreq]. Other files are
[optional][dother]. For most of the optional files, each has within its
basename the prefix of the package to which it belongs. Consider the following
examples for the ficticious package `foo`:

* `debian/foo.init`: init script, installs to `/etc/init.d/foo`
* `debian/foo.cron.hourly`: hourly cron job, installs to `/etc/cron.hourly/foo`

[dreq]:https://www.debian.org/doc/manuals/maint-guide/dreq.en.html
[dother]:https://www.debian.org/doc/manuals/maint-guide/dother.en.html

There are [many](https://www.debian.org/doc/manuals/maint-guide/dreq.en.html),
[many]() files it has some nice fallback behavior in how it goes looking for
files:

> Note for the first (or only) binary package listed in debian/control,
> debhelper will use debian/foo when there's no debian/package.foo
> file. However, it is often a good idea to keep the package. prefix as it is
> more explicit. The primary exception to this are files that debhelper by
> default installs in every binary package when it does not have a package
> prefix (such as debian/copyright or debian/changelog).

-- http://man7.org/linux/man-pages/man7/debhelper.7.html, "Debhelper Config Files" section

This association to an implicit package name is useful, say, when you don't
know the name of the package for which you want to install artifacts. This is
exactly the case for ROS packages targeting a Debian-like OS; i.e., the
developer doesn't know the name of the package until _after_ the package is
bloomed.



Better yet, one can use template files. Files within the catkin project
`debian` directory bearing the `TEMPLATE_EXTENSION` (defined in
[`bloom/generators/debian/generator.py`][bloomgendeb] and defaulting to `.em`)
will be expanded via [`empy`][empy]. This is the mechanism `bloom` uses to
generate For details, see the contents of
https://github.com/ros-infrastructure/bloom/tree/master/bloom/generators/debian/templates
.

[empy]:http://www.alcyone.com/software/empy/

In the case where you have a `debian/foo` and a `debian/foo.em`, the expansion of the latter overwrites the former.

todo: write this



[bloom]:https://github.com/ros-infrastructure/bloom
[bloomgendeb]:https://github.com/ros-infrastructure/bloom/blob/master/bloom/generators/debian/generator.py
[catkin]:https://github.com/ros/catkin
[debhelper]:https://salsa.debian.org/debian/debhelper
[debmaintguide]:https://www.debian.org/doc/manuals/maint-guide/
[ros]:https://www.ros.org/
[systemdservice]:https://www.freedesktop.org/software/systemd/man/systemd.service.html
[udev]:http://man7.org/linux/man-pages/man7/udev.7.html
